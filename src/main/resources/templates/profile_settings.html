<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:with="lang=${#locale.language}" th:lang="${lang}">
<head>
    <meta charset="UTF-8">
    <title>PreAcademic Info</title>
    <link rel="stylesheet" th:href="@{/css/common.css}"/>
    <link rel="stylesheet" th:href="@{/css/fragments/header.css}"/>
    <script th:src="@{/dependencies/jquery-3.3.1.min.js}"></script>
    <script th:src="@{/dependencies/bootstrap.min.js}"></script>
    <script th:src="@{/dependencies/bootstrapValidator.js}"></script>
    <link th:href="@{/dependencies/bootstrap.min.css} " rel="stylesheet">
    <script th:src="@{/js/common.js}"></script>
    <script th:src="@{/js/profile_settings.js}"></script>
    <script th:src="@{/js/fragments/lang-picker.js}"></script>
    <script th:src="@{/js/fragments/modals.js}"></script>
    <link rel="stylesheet" th:href="@{/css/fragments/modals.css}"/>
    <script th:inline="javascript">
        let user = /*[[${user}]]*/ '';
    </script>
    <script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js"
            integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0"
            crossorigin="anonymous"></script>
</head>
<body>
<div th:replace="fragments/header :: header(true)"></div>

<div class="emp-profile form-group" id="validator">
        <div class="row">
            <div class="col-lg-3">
                <div class="profile-img">
                        <img id="profile-img-input" src="../../static/images/profile.jpg" th:src="@{/images/profile.jpg}" alt="Image preview..."/>
                        <div class="file btn btn-primary" style="margin-bottom: 40px;">
                            Change Photo
                            <input type="file" name="file" onchange="previewFile()"/>
                        </div>
                        <div class="file btn btn-danger" onclick="delete_photo()">Remove Photo</div>
                </div>
            </div>
            <div class="col-lg-9">
                <div id="profile-div" class="profile-head">
                    <div class="row" id="personal-details">
                        <div class="col-sm-12"><h4><b>Personal Details</b></h4></div>
                    </div>

                    <div class="row" id="password-settings" style="padding-top: 10px">
                        <div class="col-sm-4"><h4><b>Change Password</b></h4></div>
                        <div class="col-md-8">
                            <button type="button" onclick="change_password()" class="btn btn-danger" id="change_passwd-btn" name="Change">Change</button>
                            <button type="button" onclick="save_passwd()" class="btn btn-danger" id="save-btn" name="Save" style="display: none">Save</button>
                            <button type="button" onclick="cancel()" class="btn btn-default" id="cancel-btn" name="Cancel" style="display: none">Cancel</button>
                        </div>
                    </div>

                    <div class="row" id="profile-settings" style="padding-top: 20px">
                        <div class="col-sm-4"><h4><b>Profile Settings</b></h4></div>
                    </div>
                </div>
            </div>
        </div>
    <div th:replace="/fragments/modals :: response-modal ('modal_success', true, #{modal.response.success})"></div>
    <div th:replace="/fragments/modals :: response-modal ('modal_failure', false, #{modal.response.failure})"></div>
</div>
</body>
</html>

<script>
    function previewFile(){
        var preview = document.getElementById('profile-img-input'); //selects the query named img
        var file    = document.querySelector('input[type=file]').files[0]; //sames as here
        var reader  = new FileReader();

        reader.onloadend = function (event) {
            let image = event.target.result;
            preview.src = image;
            user.profilePhoto = image;
            save();
        };

        if (file) {
            if (file.size > 1048576)
            {
                alert("The dimension file has to be less than 1 MB.");
                return;
            }
            reader.readAsDataURL(file); //reads the data as a URL
        }
    }
    $(document).ready(function(){
        create_user_details();
    });
</script>